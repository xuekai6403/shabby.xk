I"®<p>ä½¿ç”¨å¹³å°é€šé“ç¼–å†™å¹³å°ç‰¹å®šçš„ä»£ç </p>

<p>æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªå°é¡¹ç›®è¯´æ˜è¿™ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯ç”¨æ¥è·å–IOSå’Œå®‰å“è®¾å¤‡çš„å½“å‰ç”µæ± ç”µé‡ã€‚</p>

<h4 id="1plugins-code">1.Plugins Code</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
//é€šé“çš„å®¢æˆ·ç«¯å’Œå®¿ä¸»é€šè¿‡é€šé“æ„é€ å‡½æ•°ä¸­ä¼ é€’çš„é€šé“åç§°(samples.flutter.io/battery)è¿›è¡Œè¿æ¥
static const platform = const MethodChannel('samples.flutter.io/battery');

//åŠŸèƒ½å‡½æ•°(è·å–ç”µæ± ç”µé‡)
static Future&lt;String&gt; get platformVersion async {
    final String version = await _channel.invokeMethod('getBatteryLevel');
    return version;
}

</code></pre></div></div>

<h4 id="2ios-codeoc">2.IOS Codeï¼ˆOCï¼‰</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//1.å¯¼å…¥Flutterï¼ˆæ³¨æ„Podï¼‰

#import &lt;Flutter/Flutter.h&gt;

//2.æ‰“é€šé€šé“

- (BOOL)application:(UIApplication *)application
    didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
  [GeneratedPluginRegistrant registerWithRegistry:self];
    FlutterViewController* controller = (FlutterViewController*)self.window.rootViewController;
    FlutterMethodChannel* batteryChannel = [FlutterMethodChannel
                                            methodChannelWithName:@"com.xuekai/getbattry"
                                            binaryMessenger:controller];
    [batteryChannel setMethodCallHandler:^(FlutterMethodCall* call, FlutterResult result) {
        // TODO
        if ([@"getBatteryLevel" isEqualToString:call.method]) {
            int batteryLevelInt = [self getBatteryLevel];
            NSString *batteryLevel = [NSString stringWithFormat:@"%d%%",batteryLevelInt];
            if (batteryLevelInt == -1) {
                result([FlutterError errorWithCode:@"UNAVAILABLE"
                                           message:@"Battery info unavailable"
                                           details:nil]);
            } else {
                result(batteryLevel);
            }
        } else {
            result(FlutterMethodNotImplemented);
        }
    }];
  return [super application:application didFinishLaunchingWithOptions:launchOptions];
}

//3.IOSåŠŸèƒ½å‡½æ•°(è·å–ç”µé‡)

- (int)getBatteryLevel {
    UIDevice* device = UIDevice.currentDevice;
    device.batteryMonitoringEnabled = YES;
    if (device.batteryState == UIDeviceBatteryStateUnknown) {
        return -1;
    } else {
        return (int)(device.batteryLevel * 100);
    }
}

</code></pre></div></div>

<h4 id="3android-codejava">3.Android Codeï¼ˆJavaï¼‰</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//1.å¯¼å…¥Flutter

import io.flutter.app.FlutterActivity;
import io.flutter.plugins.GeneratedPluginRegistrant;
import io.flutter.plugin.common.MethodCall;
import io.flutter.plugin.common.MethodChannel;
import io.flutter.plugin.common.MethodChannel.MethodCallHandler;
import io.flutter.plugin.common.MethodChannel.Result;

//2.å»ºç«‹é€šé“

private static final String CHANNEL = "com.xuekai/getbattry";

new MethodChannel(getFlutterView(), CHANNEL).setMethodCallHandler(
            new MethodCallHandler() {
              @Override
              public void onMethodCall(MethodCall methodCall, Result result) {
                if (methodCall.method.equals("getBatteryLevel")) {
                  int batteryLevel = getBatteryLevel();

                  if (batteryLevel != -1) {
                    result.success(String.valueOf(batteryLevel));
                  } else {
                    result.error("UNAVAILABLE", "Battery level not available.", null);
                  }
                } else {
                  result.notImplemented();
                }
              }
            }
    );

//3.åŠŸèƒ½å‡½æ•°

private int getBatteryLevel() {
    int batteryLevel = -1;
    if (VERSION.SDK_INT &gt;= VERSION_CODES.LOLLIPOP) {
      BatteryManager batteryManager = (BatteryManager) getSystemService(BATTERY_SERVICE);
      batteryLevel = batteryManager.getIntProperty(BatteryManager.BATTERY_PROPERTY_CAPACITY);
    } else {
      Intent intent = new ContextWrapper(getApplicationContext()).
              registerReceiver(null, new IntentFilter(Intent.ACTION_BATTERY_CHANGED));
      batteryLevel = (intent.getIntExtra(BatteryManager.EXTRA_LEVEL, -1) * 100) /
              intent.getIntExtra(BatteryManager.EXTRA_SCALE, -1);
    }
    return batteryLevel;
  }
  
</code></pre></div></div>

<h4 id="4test-code">4.Test Code</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>platformVersion = await Getbattry.platformVersion
</code></pre></div></div>
:ET